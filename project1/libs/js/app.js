import{jawgKey}from"./config.js";const country={iso2:"",population:0,countryName:"",currency:"",capital:"",flag:"",area:0,mintemp:0,maxtemp:0,windspeed:0,weathericon:"",weatherDescription:"",activeCovidCases:0,criticalCovidcases:0,totalCovidCases:0,totalCovidDeaths:0,USDexchange:0,EURexchange:0,newsTitle:"",newsTitle2:"",newsTitle3:"",newsTitle4:"",newsLink:"",newsLink2:"",newsLink3:"",newsLink4:"",newsImage:"",newsImage2:"",newsImage3:"",newsImage4:"",officialName:"",demonym:"",currencyName:"",currencySymbol:"",languages:[]},iconOptions={iconUrl:"./libs/css/marker-red.png",iconSize:[30,30]};let clickLocationLat=0,clickLocationLng=0,getCapital=!1,placeName="",timeoffset=0,screenCheck=window.matchMedia("(min-width: 400px)"),geoJsonFeature={};const markers=L.markerClusterGroup();$(document).ready(function(){$(".spinner-wrapper").length&&$(".spinner-wrapper").delay(3e3).fadeOut(3e3,function(){$(".spinner-wrapper").remove()})});const map=L.map("map").fitWorld(),mapDesign=L.tileLayer("https://tile.jawg.io/jawg-streets/{z}/{x}/{y}{r}.png?access-token={accessToken}",{attribution:'<a href="http://jawg.io" title="Tiles by  Jawg Maps" target="_blank">&copy; <b>Jawg</b>Maps</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',minZoom:0,maxZoom:22,subdomains:"abcd",accessToken:jawgKey,crossOrigin:""});mapDesign.addTo(map);const redIcon=L.icon(iconOptions),onLocationFound=t=>{clickLocationLat=t.latlng.lat,clickLocationLng=t.latlng.lng;const e=t.accuracy/2;L.marker(t.latlng,{icon:redIcon,clickable:!0,zIndexOffset:200}).bindPopup("&#x1F30E You are here!").openPopup().addTo(map),L.circleMarker(t.latlng,e).addTo(map),getSelectData(),getCountryCode(clickLocationLat,clickLocationLng)},onLocationError=t=>{clickLocationLat=51.50853,clickLocationLng=-.12574,getCapital=!0,getSelectData(),getCountryCode(clickLocationLat,clickLocationLng)};map.on("locationfound",onLocationFound),map.on("locationerror",onLocationError),map.locate({setView:"{clickLocationLat, clickLocationLng}",maxZoom:5}),L.easyButton('<img src="./libs/css/marker-red-small.png">',function(){map.setView([clickLocationLat,clickLocationLng],5)}).addTo(map),map.on("dblclick",function(t){getCapital=!1,getCountryCode(t.latlng.lat,t.latlng.lng),clickLocationLat=t.latlng.lat,clickLocationLng=t.latlng.lng});const getCountryCode=(t,e)=>{callApi("getCountryCode",t,e,useCountryCode)},useCountryCode=t=>{country.iso2=t.data,callApi("getCountryInfo","en",country.iso2,getBasicData),callApi("getPolygon",country.iso2,"",displayPolygon)};$("#closeModal").click(function(){$("#modal").slideUp("fast",function(){})}),$("#homebutton").click(function(){resetModal(),displayTopLevel(),$("#modal").slideDown("slow",function(){})}),$("#weatherIcon").click(function(){resetModal(),callApi("getWeather",country.capital,"metric",getWeatherData),$("#modal").slideDown("slow",function(){})}),$("#virusIcon").click(function(){resetModal(),callApi("getVirus",country.iso2,!1,getVirusData),$("#modal").slideDown("slow",function(){})}),$("#moneyIcon").click(function(){resetModal(),callApi("getMoney",country.currency,"",getMoneyData),$("#modal").slideDown("slow",function(){})}),$("#newsIcon").click(function(){resetModal(),callApi("getNews",country.iso2,country.demonym,getNews),$("#modal").slideDown("slow",function(){})});const getSelectData=()=>{callApi("getSelectData","","",displaySelectData)},displaySelectData=t=>{const e=t.data;for(let t=0;t<e.length;t++){const a=e[t][0],o=e[t][1];$("#countrySelect").append(`<option value="${o}">${a}</option>`)}};$("#countrySelect").change(function(){country.iso2=$("#countrySelect option:selected").val(),getCapital=!0,callApi("getCountryInfo","en",country.iso2,getBasicData),callApi("getPolygon",country.iso2,"",displayPolygon)});const getBasicData=t=>{const e=t.data[0];if(country.population=parseFloat(e.population/1e6),country.countryName=e.countryName,country.currency=e.currencyCode,country.capital=e.capital,screenCheck.matches?country.flag=`https://www.countryflags.io/${country.iso2}/shiny/64.png`:country.flag=`https://www.countryflags.io/${country.iso2}/shiny/48.png`,country.area=Math.round(e.areaInSqKm).toLocaleString("en-US"),$("#titleCountry").html(country.countryName),$("#flag").attr("src",country.flag),callApi("getMoreCountryInfo",country.iso2,country.currency,saveMoreBasicData),!1===getCapital)callApi("getPlaceInfo",clickLocationLat,clickLocationLng,zoomToPlace);else{let t=country.capital.split(" ").join("_");"New_Delhi"===t&&(t="Delhi"),callApi("getCapitalCoords",t,"",zoomToPlace)}},saveMoreBasicData=t=>{country.officialName=t.officialName,country.demonym=t.demonym,country.currencyName=t.currencies.name,country.currencySymbol=t.currencies.symbol,country.languages=t.languages,displayTopLevel()},zoomToPlace=t=>{getCapital?(clickLocationLat=t.data.lat,clickLocationLng=t.data.lng,placeName=country.capital):placeName=t.data;const e=t.sunrise;timeoffset=t.timeoffset;const a=getSunrise(e);setCurrentTime(timeoffset);const o={lat:clickLocationLat,lng:clickLocationLng,zoom:5};map.setZoom(5).flyTo(o);const n=L.marker([clickLocationLat,clickLocationLng],{icon:redIcon,clickable:!0,ZindexOffset:200,opacity:.8});getCapital?n.addTo(map).bindPopup(`The capital of ${country.countryName} is ${country.capital}. <br>${a}`):n.addTo(map).bindPopup(`This is ${placeName}. <br>${a}`),callApi("getCafes",clickLocationLat,clickLocationLng,displayMarkers)},getSunrise=t=>{const e=new Date(1e3*t);return`The sun rose at ${e.getUTCHours().toString().padStart(2,0)}:${e.getUTCMinutes().toString().padStart(2,0)}:${e.getUTCSeconds().toString().padStart(2,0)}`},setCurrentTime=t=>{const e=Date.now(),a=new Date(e+1e3*t),o=a.getUTCHours().toString().padStart(2,0),n=a.getUTCMinutes().toString().padStart(2,0);$("#timeDisplay").html(`${o}:${n}`)},displayPolygon=t=>{geoJsonFeature=t.data.length>1?{type:"Feature",geometry:{type:"MultiPolygon",coordinates:t.data}}:{type:"Feature",geometry:{type:"Polygon",coordinates:t.data}},L.geoJson(geoJsonFeature,{style:{color:"#ffe135",opacity:"0.7",weight:"2"}}).addTo(map)},displayTopLevel=()=>{$("#item-A").html(country.officialName),$("#flag2").attr("src",country.flag),$("#item-B").html("Capital:"),$("#item-2").html(country.capital),$("#item-C").html("Population:"),$("#item-3").html(country.population.toFixed(2)+"m"),$("#item-D").html("Inhabitants:"),$("#item-D").append("<br>Area:"),$("#item-4").html(country.demonym),$("#item-4").append(`<br>${country.area} km2`),$("#item-E").html("Languages:");const t=Object.values(country.languages);if($("#item-5").html(`${t[0]}`),t.length>1)for(let e=1;e<t.length;e++)$("#item-5").append(`<br>${t[e]}`)},resetModal=()=>{$("#item-A").html(""),$("#item-B").html(""),$("#item-2").html(""),$("#item-C").html(""),$("#item-3").html(""),$("#item-D").html(""),$("#item-4").html(""),$("#item-E").html(""),$("#item-5").html("")},getWeatherData=t=>{const e=t.data;country.weatherDescription=e.weather[0].description,country.maxtemp=e.main.temp_max,country.mintemp=e.main.temp_min,country.windspeed=parseFloat(e.wind.speed),country.windspeed=(2.23694*country.windspeed).toFixed(2),country.weathericon=e.weather[0].icon,displayWeather()},displayWeather=()=>{$("#item-A").html("The Weather Today"),screenCheck.matches?$("#item-B").html(`<img src="http://openweathermap.org/img/wn/${country.weathericon}@2x.png" alt="Weather conditions:">`):$("#item-B").html(`<img src="http://openweathermap.org/img/wn/${country.weathericon}.png" alt="Weather conditions:">`),$("#item-2").html(country.weatherDescription),$("#item-C").html("Max Temp:"),$("#item-3").html(`${country.maxtemp}&#176;C`),$("#item-D").html("Min Temp:"),$("#item-4").html(`${country.mintemp}&#176;C`),$("#item-E").html("Wind Speed:"),$("#item-5").html(`${country.windspeed} mph`)},getVirusData=t=>{const e=t.data;country.activeCovidCases=e.active.toLocaleString("en-US"),country.criticalCovidcases=e.critical.toLocaleString("en-US"),country.totalCovidCases=e.cases.toLocaleString("en-US"),country.totalCovidDeaths=e.deaths.toLocaleString("en-US"),displayVirus()},displayVirus=()=>{$("#item-A").html("Coronavirus Rates"),$("#item-B").html("Active cases:"),$("#item-2").html(country.activeCovidCases),$("#item-C").html("Critical cases:"),$("#item-3").html(country.criticalCovidcases),$("#item-D").html("Total cases:"),$("#item-4").html(country.totalCovidCases),$("#item-E").html("Total deaths:"),$("#item-5").html(country.totalCovidDeaths)},getMoneyData=t=>{const e=t.data.conversion_rates;country.USDexchange=e.USD,country.EURexchange=e.EUR,displayMoney()},displayMoney=()=>{$("#item-A").html(`Currency (${country.currency})`),$("#item-B").html("Money:"),$("#item-2").html(country.currencyName),$("#item-C").html("Symbol:"),$("#item-3").html(country.currencySymbol),$("#item-D").html("Exchange Rate with US $:"),$("#item-4").html(country.USDexchange),$("#item-E").html("Exchange Rate with Euros &#8364;:"),$("#item-5").html(country.EURexchange)},getNews=t=>{const e=t.data;e[0]&&(country.newsTitle=e[0][0],country.newsLink=e[0][1],country.newsImage=e[0][2]),e[1]&&(country.newsTitle2=e[1][0],country.newsImage2=e[1][2],country.newsLink2=e[1][1]),e[2]&&(country.newsTitle3=e[2][0],country.newsLink3=e[2][1],country.newsImage3=e[2][2]),e[4]&&(country.newsTitle4=e[3][0],country.newsLink4=e[3][1],country.newsImage4=e[3][2]),displayNews()},displayNews=()=>{$("#item-A").html("Latest News"),$("#item-B").html(`<img class="newsImage" src=${country.newsImage}>`),$("#item-2").html(`<a href=${country.newsLink} target="_blank">${country.newsTitle}</a>`),$("#item-C").html(`<img class="newsImage" src=${country.newsImage2}>`),$("#item-3").html(`<a href=${country.newsLink2} target="_blank">${country.newsTitle2}</a>`),$("#item-D").html(`<img class="newsImage" src=${country.newsImage3}>`),$("#item-4").html(`<a href=${country.newsLink3} target="_blank">${country.newsTitle3}</a>`),$("#item-E").html(`<img class="newsImage" src=${country.newsImage4}>`),$("#item-5").html(`<a href=${country.newsLink4} target="_blank">${country.newsTitle4}</a>`)},displayMarkers=t=>{t.data.map(t=>{let e=L.marker(t[1]).bindPopup(`\t&#9749; This is ${t[0]}`);markers.addLayer(e)}),markers.addTo(map)},toggleMarkers=L.easyButton({states:[{stateName:"remove-markers",icon:'<img src="./libs/css/blackCoffee.png">',title:"Hide Cafes",onClick:function(t,e){e.removeLayer(markers),t.state("add-markers")}},{stateName:"add-markers",icon:'<img src="./libs/css/coffee.png">',title:"Show Cafes",onClick:function(t,e){markers.addTo(e),t.state("remove-markers")}}]});toggleMarkers.addTo(map);const callApi=(t,e,a,o)=>{const n=`libs/php/${t}.php`;$.ajax({url:n,type:"POST",dataType:"json",data:{param1:e,param2:a},success:function(t){o(t)},error:function(t,e,a){console.log(`${n}: ajax call failed ${e}`)}})};